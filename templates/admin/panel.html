{% extends "base.html" %}
{% block title %}Panel Admin{% endblock %}

{% block content %}
<h2 class="text-white text-center mb-5">üõ†Ô∏è Panel de Administrador</h2>

<div class="text-center mb-5">
    <a href="{{ url_for('manage_admins') }}" class="btn btn-info btn-lg">
        üë• Gestionar Administradores
    </a>
</div>
<!-- Estad√≠sticas r√°pidas -->
<div class="row mb-5">
    <div class="col text-center">
        <div class="row justify-content-center">
            <div class="col-md-3 col-sm-6 mb-4">
                <div class="card bg-primary text-white shadow">
                    <div class="card-body">
                        <h3 class="fw-bold">{{ stats.pending_count }}</h3>
                        <p class="mb-0">Grupos pendientes</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-4">
                <div class="card bg-success text-white shadow">
                    <div class="card-body">
                        <h3 class="fw-bold">{{ stats.approved_count }}</h3>
                        <p class="mb-0">Grupos aprobados</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-4">
                <div class="card bg-info text-white shadow">
                    <div class="card-body">
                        <h3 class="fw-bold">{{ stats.total_groups }}</h3>
                        <p class="mb-0">Total grupos</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 mb-4">
                <div class="card bg-warning text-dark shadow">
                    <div class="card-body">
                        <h3 class="fw-bold">{{ stats.admins_count }}</h3>
                        <p class="mb-0">Administradores</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Grupos pendientes de aprobaci√≥n -->
{% if pending %}
    <h4 class="text-white">Grupos pendientes (confirmados por email)</h4>
    <div class="row">
        {% for group in pending %}
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5>{{ group.name }}</h5>
                        <p><strong>Enlace:</strong> <a href="{{ group.link }}" target="_blank">{{ group.link }}</a></p>
                        <p><strong>Descripci√≥n:</strong> {{ group.description }}</p>
                        <p><small>Enviado por: {{ group.email }} el {{ group.submitted_at.strftime('%d/%m/%Y') }}</small></p>
                        <form method="POST" action="{{ url_for('admin_action') }}">
                            <input type="hidden" name="group_id" value="{{ group.id }}">
                            <button name="action" value="approve" class="btn btn-success btn-sm me-2">Aprobar</button>
                            <button name="action" value="delete" class="btn btn-danger btn-sm">Rechazar</button>
                        </form>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% else %}
    <div class="alert alert-info">No hay grupos pendientes de aprobaci√≥n.</div>
{% endif %}

<!-- Grupos ya aprobados -->
<h4 class="text-white mt-5">Grupos aprobados</h4>
{% if approved %}
    <div class="row">
        {% for group in approved %}
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card {% if group.pinned %}pinned{% endif %}">
                    <div class="card-body">
                        {% if group.pinned %}
                            <span class="badge badge-pinned mb-2">‚≠ê Anclado</span>
                        {% endif %}
                        <h5>{{ group.name }}</h5>
                        <p>{{ group.description | truncate(100) }}</p>
                        <p><small>Enviado por: {{ group.email }}</small></p>
                        <form method="POST" action="{{ url_for('admin_action') }}">
                            <input type="hidden" name="group_id" value="{{ group.id }}">
                            <button name="action" value="pin" class="btn btn-warning btn-sm me-2">
                                {% if group.pinned %}Desanclar{% else %}Anclar{% endif %}
                            </button>
                            <button name="action" value="delete" class="btn btn-danger btn-sm">Eliminar</button>
                        </form>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% else %}
    <div class="alert alert-secondary">No hay grupos aprobados a√∫n.</div>
{% endif %}


<div class="text-center mt-5">
    <a href="{{ url_for('admin_logout') }}" class="btn btn-outline-light btn-lg">Cerrar sesi√≥n</a>
</div>
{% endblock %}